// Year
document.getElementById('year').textContent = new Date().getFullYear();

// Scroll progress
const progress = document.getElementById('scroll-progress');
window.addEventListener('scroll', () => {
  const scrolled = (window.scrollY / (document.body.scrollHeight - window.innerHeight)) * 100;
  progress.style.width = `${scrolled}%`;
});

// Custom cursor
const cursor = document.querySelector('.cursor');
const outline = document.querySelector('.cursor-outline');
let mouseX = 0, mouseY = 0, outlineX = 0, outlineY = 0;
document.addEventListener('mousemove', (e) => {
  mouseX = e.clientX; mouseY = e.clientY;
  cursor.style.transform = `translate(${mouseX}px, ${mouseY}px)`;
});
(function animateOutline() {
  outlineX += (mouseX - outlineX) * 0.12;
  outlineY += (mouseY - outlineY) * 0.12;
  outline.style.transform = `translate(${outlineX}px, ${outlineY}px)`;
  requestAnimationFrame(animateOutline);
})();

// Reveal on scroll
const reveals = document.querySelectorAll('.reveal');
const io = new IntersectionObserver(entries => {
  entries.forEach(entry => { if (entry.isIntersecting) entry.target.classList.add('in'); });
}, { threshold: 0.12 });
reveals.forEach(el => io.observe(el));

// Smooth scroll for nav links
document.querySelectorAll('header nav a[href^="#"]').forEach(a => {
  a.addEventListener('click', (e) => {
    e.preventDefault();
    const id = a.getAttribute('href').slice(1);
    const target = document.getElementById(id);
    if (!target) return;
    window.scrollTo({ top: target.offsetTop - 56, behavior: 'smooth' });
    // Close mobile menu on selection
    closeMobileMenu();
  });
});

// Mobile hamburger menu
const header = document.getElementById('header');
const menuBtn = document.getElementById('menu-toggle');
function closeMobileMenu() {
  header.classList.remove('open');
  menuBtn.setAttribute('aria-expanded', 'false');
}
menuBtn.addEventListener('click', () => {
  const isOpen = header.classList.toggle('open');
  menuBtn.setAttribute('aria-expanded', String(isOpen));
});
window.addEventListener('resize', () => {
  // Auto-close on resizing to desktop
  if (window.innerWidth > 860) closeMobileMenu();
});

// Crest tilt (parallax)
(function() {
  const crest = document.getElementById('crest');
  if (!crest) return;
  let rx = 0, ry = 0, tx = 0, ty = 0;
  document.addEventListener('mousemove', (e) => {
    const cx = window.innerWidth/2, cy = window.innerHeight/2;
    rx = (e.clientY - cy) / window.innerHeight * -12;
    ry = (e.clientX - cx) / window.innerWidth  *  12;
  });
  (function tick(){
    tx += (rx - tx)*0.1;
    ty += (ry - ty)*0.1;
    crest.style.transform = `rotateX(${tx}deg) rotateY(${ty}deg)`;
    requestAnimationFrame(tick);
  })();
})();

/* Particles */
particlesJS('particles-js', {
  particles: {
    number: { value: 80, density: { enable: true, value_area: 800 } },
    color: { value: ['#67e8f9', '#a78bfa', '#8aa3ff'] },
    shape: { type: 'polygon', polygon: { nb_sides: 6 } },
    opacity: { value: 0.35, random: true, anim: { enable: true, speed: 0.6, opacity_min: 0.1, sync: false } },
    size: { value: 3, random: true, anim: { enable: false, speed: 40, size_min: 0.1, sync: false } },
    line_linked: { enable: true, distance: 140, color: '#89a0ff', opacity: 0.35, width: 1 },
    move: { enable: true, speed: 1.4, direction: 'none', random: false, straight: false, out_mode: 'out', bounce: false }
  },
  interactivity: {
    detect_on: 'canvas',
    events: {
      onhover: { enable: true, mode: 'grab' },
      onclick: { enable: true, mode: 'push' },
      resize: true
    },
    modes: {
      grab: { distance: 160, line_linked: { opacity: 0.35 } },
      push: { particles_nb: 3 }
    }
  },
  retina_detect: true
});

/* Sequentially marged porjects using github api */
/* === NEW GITHUB REPOS SECTION WITH CUSTOM ORDER === */

const API_BASE = '/api/repos';

// Your custom priority order
const PROJECT_ORDER = [
  'BannerGrapV2', 'GreeDoS_V2', 'EchoFi_BoX_V1-', 'DentoGuard', 'EchoFi_Pocket_Server.',
  'EchoFi_Keylogger_Primo', 'EchoFi_USB_rubber_ducky', 'EchoFi_SpiderBot', 'EchoFi_Droid',
  'EchoFi_USB_rubber_ducky', 'GreeDoS_V1', 'BannerGrapV1', 'EchoFi_8266Deauther', 'GRABBER',
  'NetWraith', 'Trios_terminal-', 'EchoFi_Kilog', 'EchoFi_BLE_Joystick', 'Echo_Snipe',
  'EchoFi_ObstacleAvoiding_Bot', 'Book-Of-Operational_Scapy-BY-Tanjib-Isham', 'Deauth_All',
  'Fidelity_Xploit', 'Lesson-of-keylogger-BY-tanjib_isham', 'E-commerce_site.',
  'Concept-of-RubberDucky-using-M5-Stamp-S3'
];

const EXCLUDE = new Set([
  'All_Projects_of_MrEchoFi_Md-Abu-Naser-Nayeem'
]);

const loadingEl = document.getElementById('projects-loading');
const errorEl = document.getElementById('projects-error');
const gridEl = document.getElementById('projects-grid');

function orderRepos(repos) {
  const filtered = repos.filter(r => !r.private && !r.fork && !EXCLUDE.has(r.name));
  // Oldest ‚Üí newest
  filtered.sort((a, b) => new Date(a.created_at) - new Date(b.created_at));

  // Pin your ordered list first
  const map = new Map(filtered.map(r => [r.name, r]));
  const prioritized = PROJECT_ORDER.map(name => map.get(name)).filter(Boolean);
  for (const p of prioritized) map.delete(p.name);
  const rest = Array.from(map.values());

  return [...prioritized, ...rest];
}

function renderProjects(repos) {
  const list = orderRepos(repos);
 function createCard(repo) {
  const desc = repo.description || "No description provided";
  const lang = repo.language || "Unknown";
  const dateStr = new Date(repo.updated_at).toLocaleDateString();
  const demoLink = repo.homepage
    ? `<a class="badge" href="${repo.homepage}" target="_blank" rel="noopener">üîó Demo</a>`
    : "";

  return `
    <a class="project reveal" href="${repo.html_url}" target="_blank" rel="noopener">
      <div class="thumb">
        <svg class="hex" viewBox="0 0 100 100">
          <polygon points="50,1 95,25 95,75 50,99 5,75 5,25"></polygon>
        </svg>
      </div>
      <h3>${repo.name}</h3>
      <p>${desc}</p>
      <div class="meta">
        <span class="badge">${lang}</span>
        <span class="badge">‚≠ê ${repo.stargazers_count}</span>
        <span class="badge">${dateStr}</span>
        ${demoLink}
      </div>
    </a>
  `;
}

// When you render:
gridEl.innerHTML = list.map(createCard).join('');

}

async function loadRepos() {
  loadingEl.hidden = false;
  errorEl.hidden = true;
  gridEl.hidden = true;

  try {
    const res = await fetch(`${API_BASE}?user=MrEchoFi`, { cache: 'no-store' });
    if (!res.ok) throw new Error(`API ${res.status}`);
    const repos = await res.json();
    renderProjects(repos);
    gridEl.hidden = false;
  } catch (e) {
    console.error(e);
    errorEl.hidden = false;
  } finally {
    loadingEl.hidden = true;
  }
}

document.addEventListener('DOMContentLoaded', loadRepos);

function orderRepos(repos, includeArchived=false) {
  let filtered = repos.filter(r =>
    !r.private && !r.fork && !EXCLUDE.has(r.name) && (includeArchived || !r.archived)
  );
  // Sequential (oldest -> newest)
  filtered.sort((a,b)=> new Date(a.created_at) - new Date(b.created_at));

  // Priority pins first
  const map = new Map(filtered.map(r => [r.name, r]));
  const prioritized = PROJECT_ORDER.map(n => map.get(n)).filter(Boolean);
  for (const p of prioritized) map.delete(p.name);
  const rest = Array.from(map.values());
  return [...prioritized, ...rest];
}

function colorFor(language, seed) {
  if (language === 'JavaScript') return ['#f7df1e','#ffd166'];
  if (language === 'TypeScript') return ['#3178c6','#63a4ff'];
  if (language === 'Python') return ['#3572A5','#6ca0dc'];
  if (language === 'C') return ['#555555','#888888'];
  if (language === 'C++') return ['#004482','#2a71b8'];
  if (language === 'Shell') return ['#89e051','#a8f07a'];
  if (language === 'HTML') return ['#e34c26','#ff7b5a'];
  if (language === 'CSS') return ['#563d7c','#8a5ef5'];
  return seed % 2 ? ['#67e8f9','#a78bfa'] : ['#a78bfa','#67e8f9'];
}
function initials(name){
  const parts = name.replace(/[-_]/g,' ').split(' ').filter(Boolean);
  const chars = parts[0]?.[0] + (parts[1]?.[0] || '');
  return (chars || name.slice(0,2)).toUpperCase().slice(0,2);
}
function hexThumbSVG(repo) {
  const seed = repo.name.length + (repo.stargazers_count||0);
  const [c1, c2] = colorFor(repo.language, seed);
  const text = initials(repo.name);
  return `
<svg class="hex" viewBox="0 0 100 100" width="64" height="64" aria-hidden="true">
  <defs>
    <linearGradient id="hexg-${repo.id}" x1="0" y1="0" x2="1" y2="1">
      <stop offset="0" stop-color="${c1}"/>
      <stop offset="1" stop-color="${c2}"/>
    </linearGradient>
    <linearGradient id="shine-${repo.id}" x1="0" y1="0" x2="1" y2="0">
      <stop offset="0" stop-color="rgba(255,255,255,0)"/>
      <stop offset="0.5" stop-color="rgba(255,255,255,0.8)"/>
      <stop offset="1" stop-color="rgba(255,255,255,0)"/>
    </linearGradient>
  </defs>
  <polygon points="50,2 96,26 96,74 50,98 4,74 4,26" fill="rgba(255,255,255,0.02)" stroke="rgba(255,255,255,0.15)" stroke-width="2"/>
  <polygon points="50,8 90,28 90,72 50,92 10,72 10,28" fill="url(#hexg-${repo.id})" opacity="0.18"/>
  <rect class="shine" x="-120" y="-20" width="80" height="160" transform="rotate(20 50 50)"/>
  <text x="50" y="58" text-anchor="middle" font-family="JetBrains Mono, monospace" font-size="28" fill="rgba(255,255,255,0.92)">${text}</text>
</svg>`;
}
function langBadge(language) {
  if (!language) return '';
  return `<span class="badge">${language}</span>`;
}
function createCard(repo) {
  const card = document.createElement('a');
  card.className = 'project reveal';
  card.href = repo.html_url;
  card.target = '_blank';
  card.rel = 'noopener';

  const desc = repo.description || 'No description provided.';
  const updated = new Date(repo.pushed_at);
  const dateStr = updated.toLocaleDateString(undefined, { year: 'numeric', month: 'short' });
  const homepage = repo.homepage && repo.homepage.trim() ? repo.homepage : null;
  const demoLink = homepage ? `<a class="badge" href="${homepage}" target="_blank" rel="noopener">Demo</a>` : '';

  card.innerHTML = `
    <div class="thumb">${hexThumbSVG(repo)}</div>
    <h3>${repo.name}</h3>
    <p>${desc}</p>
    <div class="meta">
      ${langBadge(repo.language)}
      <span class="badge">‚≠ê ${repo.stargazers_count}</span>
      
      <span class="badge" title="Last update">${dateStr}</span>
      ${demoLink}
    </div>
  `;
  return card;
}
function renderProjectsGrid(repos) {
  const grid = document.getElementById('projects-grid');
  grid.innerHTML = '';
  for (const r of repos) grid.appendChild(createCard(r));
  grid.querySelectorAll('.project').forEach(el => io.observe(el));
}
function applyFiltersAndRender() {
  const showArchived = document.getElementById('show-archived').checked;
  const ordered = orderRepos(ALL_REPOS, showArchived);
  renderProjectsGrid(ordered);
  // Hide loading bar and reset progress
  document.getElementById('projects-loading').hidden = true;
  const bar = document.getElementById('projects-progress-bar');
  if (bar) bar.style.width = '0%';
  document.getElementById('projects-grid').hidden = false;
}
async function initProjects() {
  const loading = document.getElementById('projects-loading');
  const grid = document.getElementById('projects-grid');
  const error = document.getElementById('projects-error');

  loading.hidden = false;
  grid.hidden = true;
  error.hidden = true;
  // Animate progress bar while loading
  const bar = document.getElementById('projects-progress-bar');
  if (bar) {
    bar.style.width = '0%';
    let progress = 0;
    let interval = setInterval(() => {
      progress += Math.random() * 18 + 7; // random step for effect
      if (progress > 90) progress = 90;
      bar.style.width = progress + '%';
    }, 300);
    loading._progressInterval = interval;
  }

  try {
    await loadRepos();

    // On success, fill bar to 100% and hide after a short delay
    const bar = document.getElementById('projects-progress-bar');
    if (bar) {
      bar.style.width = '100%';
      setTimeout(() => {
        if (loading._progressInterval) clearInterval(loading._progressInterval);
        applyFiltersAndRender();
      }, 400);
    } else {
      applyFiltersAndRender();
    }
  } catch (e) {
    console.error(e);
    if (loading._progressInterval) clearInterval(loading._progressInterval);
    loading.hidden = true;
    error.hidden = false;
    if (error) {
      error.textContent = e.message || 'Failed to load repositories. Please try again later.';
    }
  }
}

// Live search (no refetch)
const liveSearch = (() => {
  let t; return () => {
    clearTimeout(t);
    t = setTimeout(() => {
      const q = document.getElementById('project-search').value.toLowerCase();
      document.querySelectorAll('#projects-grid .project').forEach(card => {
        const text = card.textContent.toLowerCase();
        card.style.display = text.includes(q) ? '' : 'none';
      });
    }, 120);
  };
})();
document.getElementById('project-search').addEventListener('input', liveSearch);
document.getElementById('show-archived').addEventListener('change', applyFiltersAndRender);

initProjects();

























/* mobile-fix.css */
/* 1) Universal safety nets */
*,
*::before,
*::after { box-sizing: border-box; min-width: 0; }
html { -webkit-text-size-adjust: 100%; }
body { margin: 0; width: 100%; max-width: 100vw; overflow-x: hidden; }

/* Images/icons never overflow */
img, svg, video, canvas { max-width: 100%; height: auto; display: block; }

/* Common containers center and pad on small screens */
header, main, footer, section, nav, .container {
  width: 100%;
  max-width: 100%;
  padding-left: 16px;
  padding-right: 16px;
  margin-left: auto;
  margin-right: auto;
}

/* 2) Default mobile layout: single column, centered */
@media (max-width: 768px) {
  /* Typography and spacing scale down a bit */
  :root { --gap-sm: 8px; --gap-md: 12px; --gap-lg: 16px; }

  /* Prevent left hugging */
  .intro, .bio, .hero, .about, .profile, .content, .section {
    margin-left: auto !important;
    margin-right: auto !important;
    text-align: center !important;
  }

  /* Logo / crest */
  .logo, #logo, #crest, .site-logo {
    display: block !important;
    margin: 0 auto !important;
    max-width: 140px !important;
  }

  /* Navigation: stacked and centered */
  header nav, nav[role="navigation"], .navbar {
    display: flex !important;
    flex-direction: column !important;
    align-items: center !important;
    gap: var(--gap-md) !important;
    width: 100% !important;
  }
  nav ul, .nav-list, .menu {
    display: flex !important;
    flex-wrap: wrap !important;
    gap: var(--gap-sm) !important;
    justify-content: center !important;
    padding: 0 !important;
    margin: 0 !important;
    list-style: none !important;
    width: 100% !important;
  }
  nav li, .nav-item { flex: 0 1 auto !important; }

  /* Social buttons never overlap */
  .social, .socials, .social-buttons, .contacts {
    display: flex !important;
    flex-wrap: wrap !important;
    gap: var(--gap-sm) !important;
    justify-content: center !important;
    width: 100% !important;
    margin-top: var(--gap-md) !important;
  }
  .social a, .socials a, .social-buttons a, .contacts a,
  .social button, .contacts button {
    flex: 1 1 46% !important;  /* two per row */
    text-align: center !important;
    padding: 10px !important;
    min-width: 140px !important;
  }

  /* Photo/avatar */
  .photo, .avatar, .profile-pic { margin: var(--gap-lg) auto !important; }
  .photo img, .avatar img, .profile-pic img {
    width: 100% !important;
    max-width: 220px !important;
    border-radius: 50% !important;
    margin: 0 auto !important;
  }

  /* Projects: single column */
  #projects, .projects, .project-grid, [class*="projects"] {
    display: grid !important;
    grid-template-columns: 1fr !important;
    gap: var(--gap-lg) !important;
    width: 100% !important;
  }
  .project, .card, .project-card {
    width: 100% !important;
    max-width: 100% !important;
  }

  /* Background art stays centered and contained */
  .hero, .banner, .masthead, .cover {
    background-position: center center !important;
    background-size: cover !important;
    background-repeat: no-repeat !important;
  }

  /* Kill absolute layouts that cause overlap on mobile */
  [style*="position:absolute"], .absolute {
    position: static !important;
    inset: auto !important;
    transform: none !important;
  }

  /* Buttons and links wrap properly */
  a, button {
    white-space: normal !important;
    word-break: break-word !important;
  }

  /* Prevent giant fixed widths */
  [style*="width:"], .w-fixed, .fixed-width {
    max-width: 100% !important;
  }

  /* Typography scaling for small screens */
  h1 { font-size: clamp(22px, 6vw, 32px) !important; }
  h2 { font-size: clamp(18px, 5vw, 26px) !important; }
  p, li, a, button, input { font-size: clamp(14px, 3.8vw, 18px) !important; }

  /* Gaps */
  .row, .flex, [class*="row"], [class*="flex"] {
    display: flex !important;
    flex-wrap: wrap !important;
    gap: var(--gap-md) !important;
  }
}

@media (max-width: 768px) {
  #menu-toggle { display: inline-block !important; }
  #primary-menu { display: none; }
  #primary-menu[data-open="true"] { display: block !important; }
}
@media (min-width: 769px) {
  #menu-toggle { display: none; }
  #primary-menu { display: block !important; }
}


